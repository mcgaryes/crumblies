<!DOCTYPE html>  <html> <head>   <title>003_prototype_mixins.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="001_prototypal-inheritance.html">                 001_prototypal-inheritance.js               </a>                                           <a class="source" href="002_extending-prototypes.html">                 002_extending-prototypes.js               </a>                                           <a class="source" href="003_prototype_mixins.html">                 003_prototype_mixins.js               </a>                                           <a class="source" href="004_chaining.html">                 004_chaining.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               003_prototype_mixins.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="cm">/*global console:false */</span>
<span class="s2">&quot;use strict&quot;</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Our mixin functionality. This is a pretty generic mixin function that simply looks at each property in the supplier (which is what we're mixing in) and apply it to the prototype of the current context.
It is important to note that this is an ECMAScript 5 version of a mixin and will not work in legacy browsers. There are numerous polyfils available for backwards compatibility.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">mixin</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">supplier</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">prototype</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
  <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">supplier</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">prop</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">prototype</span><span class="p">,</span> <span class="nx">prop</span><span class="p">,</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">getOwnPropertyDescriptor</span><span class="p">(</span><span class="nx">supplier</span><span class="p">,</span> <span class="nx">prop</span><span class="p">));</span>
  <span class="p">});</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>This is a very similar <code>Vehicle</code> constructor and prototype from <a href="https://github.com/mcgaryes/crumblies/tree/master/js101/discussions">earlier discussions</a>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">Vehicle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">color</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="nx">color</span><span class="p">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>The <code>Vehicle</code> prototype</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Vehicle</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">({},</span> <span class="p">{</span>
  <span class="nx">type</span><span class="o">:</span> <span class="p">{</span> <span class="nx">value</span><span class="o">:</span> <span class="s2">&quot;none&quot;</span> <span class="p">},</span>
  <span class="nx">color</span><span class="o">:</span> <span class="p">{</span> <span class="nx">value</span><span class="o">:</span> <span class="s2">&quot;grey&quot;</span> <span class="p">},</span>
  <span class="nx">start</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">value</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Starting the &quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">color</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">type</span> <span class="o">+</span> <span class="s2">&quot; up...&quot;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nx">stop</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">value</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Turning the &quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">color</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">type</span> <span class="o">+</span> <span class="s2">&quot; off...&quot;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>In future discussions we'll be talking about various design patterns like the <em>Decorator Pattern</em>, which steering could be a prime example of. In this discussion however <code>Steering</code> simply has some functionality that we want to mix in, specifically the steering type and turn method.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">Steering</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">steering</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>You could perform more specific steering functionality here. If setting the steering property is all that you actually needed to do here then the Steering constructor in a real world example could simply be omited since its sole purpose is to provide mixed in functionality for the <code>Car</code> prototype as we'll see in a second.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">steering</span> <span class="o">=</span> <span class="nx">steering</span><span class="p">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>The <code>Steering</code> prototype</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Steering</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">steering</span><span class="o">:</span> <span class="s2">&quot;standard&quot;</span><span class="p">,</span> <span class="c1">// power steering obviously does not come standard!</span>
  <span class="nx">turn</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">steering</span> <span class="o">?</span> <span class="s2">&quot;Turning is a breeze!&quot;</span> <span class="o">:</span> <span class="s2">&quot;At least i&#39;m getting by workout in for today!&quot;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Here we'll reintroduce the Car constructor as well as the first bit of our <em>mixin</em> functionality. You'll notice that we're using the <code>Function.call</code> referencened in the last discussion, but here we're using it twice. Once, for the <code>Vehicle</code> functionality and once for our new <code>Steering</code> functionality. Following this structure car instances could inherit [mixin] from many different sources.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">Car</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">color</span><span class="p">,</span> <span class="nx">steering</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Like stated a little bit earlier in most cases you didn't have any complex functionality occuring in the <code>Steering</code> constructor then it could simply be omitted. I thought it was worth leaving for now because it show how you could potentially have multiple constructors running on the same instance.
Try ommitting this code in the <a href="">JSBin</a> of this discussion and logging out the <code>Car.prototype</code>. You'll see that <code>turn</code> and <code>steering</code> are still referenced (just that no function calls have been called on them).</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Steering</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">steering</span><span class="p">);</span>
  <span class="nx">Vehicle</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">color</span><span class="p">);</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>The 'Car' prototype</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Car</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">Vehicle</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">type</span><span class="o">:</span> <span class="p">{</span> <span class="nx">value</span><span class="o">:</span> <span class="s2">&quot;car&quot;</span> <span class="p">},</span>
  <span class="nx">windows</span><span class="o">:</span> <span class="p">{</span> <span class="nx">value</span><span class="o">:</span> <span class="mi">4</span> <span class="p">},</span>
  <span class="nx">rollDownWindows</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">value</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Rolling down &quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">windows</span> <span class="o">+</span> <span class="s2">&quot; windows...&quot;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Here we are simply just applying our predifined mixin (above) function to our <code>Car</code> constructor. This is a sense adding what you would classify as a static method in other Class based languages. In JavaScript terms we're simply referencing a new method on our <code>Car</code> constructor.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Vehicle</span><span class="p">.</span><span class="nx">mixin</span> <span class="o">=</span> <span class="nx">Car</span><span class="p">.</span><span class="nx">mixin</span> <span class="o">=</span> <span class="nx">mixin</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Mixin the <code>Steering</code> prototype with our <code>Car</code> prototype</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Car</span><span class="p">.</span><span class="nx">mixin</span><span class="p">(</span><span class="nx">Steering</span><span class="p">.</span><span class="nx">prototype</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Create an instance of the <code>Car</code>. Set it's <code>color</code> to "blue" (used by the <code>Vehicle</code> constructor) and its <code>steering</code> to "power" (used by the <code>Steering</code> constructor).</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">car</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Car</span><span class="p">(</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span><span class="s2">&quot;power&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Perform some functionality on the car instance</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">car</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span> <span class="c1">// Should log `Starting the blue car up...`</span>
<span class="nx">car</span><span class="p">.</span><span class="nx">rollDownWindows</span><span class="p">();</span> <span class="c1">// Should log `Rolling down 4 windows...`</span>
<span class="nx">car</span><span class="p">.</span><span class="nx">turn</span><span class="p">();</span> <span class="c1">// Should log `Turning is a breeze!`</span>
<span class="nx">car</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span> <span class="c1">// Should log `Turning the blue car off...`</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Very quickly i just wanted to bring a concept up that we'll cover in furture discussion, but is worth noting here. Above when I applied the mixin method to the <code>Car</code> constructor I did the same to the <code>Vehicle</code> constructor. I think this very adequetly illustrates the power of abstract methods. Abstract in the sense that you would never actually call the <code>mixin</code> method on its own like this:</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>mixin({ foo:"bar" }); // commented out because it will throw an error</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Because mixin is simply a method that is available (because of the way we wrote it) to be assigned to any constructor it is an <em>abstract method</em>. Note how it was applied to both <code>Vehicle</code> and <code>Car</code>, but will reference different prototypes depending on which is called. This is a great way to avoid duplicating code for functionality that should be available to multiple constructors.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Vehicle</span><span class="p">.</span><span class="nx">mixin</span><span class="p">({</span> <span class="nx">foo</span><span class="o">:</span><span class="s2">&quot;foo&quot;</span> <span class="p">});</span>
<span class="nx">Car</span><span class="p">.</span><span class="nx">mixin</span><span class="p">({</span> <span class="nx">foo</span><span class="o">:</span><span class="s2">&quot;bar&quot;</span> <span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">Vehicle</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">foo</span><span class="p">);</span> <span class="c1">// Should log `foo`</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">Car</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">foo</span><span class="p">);</span> <span class="c1">// Should log `bar`</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>So to wrap up the above example showed a few different concepts:</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <ol>
<li>Simple mixin functionality for inheriting from more than one source.</li>
<li>How to run an instance through multiple constructors</li>
<li>How to write and apply <em>abstract methods</em> to constructors</li>
</ol>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 