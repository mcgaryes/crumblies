<!DOCTYPE html>  <html> <head>   <title>004_chaining.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="001_prototypal-inheritance.html">                 001_prototypal-inheritance.js               </a>                                           <a class="source" href="002_extending-prototypes.html">                 002_extending-prototypes.js               </a>                                           <a class="source" href="003_prototype_mixins.html">                 003_prototype_mixins.js               </a>                                           <a class="source" href="004_chaining.html">                 004_chaining.js               </a>                                           <a class="source" href="005_singleton.html">                 005_singleton.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               004_chaining.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="cm">/* jshint newcap:false */</span>
<span class="s2">&quot;use strict&quot;</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>The following example is what most people run into when they try to perform multiple processes on an object.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">hello</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;hello&quot;</span><span class="p">];</span>
  <span class="nx">callback</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">world</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">args</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;world!&quot;</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">));</span>
<span class="p">};</span>

<span class="nx">hello</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">world</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>While this example is very simple you could see where adding subsequent method calls would really start to get messy...</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">very</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">args</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;very&quot;</span><span class="p">);</span>
  <span class="nx">callback</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">big</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">args</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;big&quot;</span><span class="p">);</span>
  <span class="nx">callback</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>As you can see it starts to get very hard to follow. Not to mention we're currently only passing two arguments. Imagine passing 3 or 4!</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">hello</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">very</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">big</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">world</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>With chaining we can alleviate some of these pains. The following is a simple example that illustrates how we can return the object we're currently working on in an initial method call that can then be be used to call a subsequent method.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">hello</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="nx">obj</span><span class="p">.</span><span class="nx">log</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">];</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>here we're setting the function world as a property on the object we're about to return.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">obj</span><span class="p">.</span><span class="nx">world</span> <span class="o">=</span> <span class="nx">world</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>And here we're returning the object that we'll eventually run another method on.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">return</span> <span class="nx">obj</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">world</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">log</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;world&quot;</span><span class="p">,</span> <span class="s2">&quot;!&quot;</span><span class="p">];</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">));</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>As you can see when we call <code>hello</code> and <code>world</code> again we can simple "chain" the methods together you dot notation.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">hello</span><span class="p">().</span><span class="nx">world</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>You might be saying, while that's good an all having to assign the next method in the chain could be as confusing as passing and wrapping in callbacks. This is where the prototype object and a little bit of JavaScript recursion comes to the rescue! 
We'll simply create a contructor/prototype pair like we've done in previous discussions and combine instance creation with a simple recursion so that we can chain any prototype methods that return the instance.
The following is a simple MathUtil that makes it possible to chain arithmetic operations.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">MathUtil</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>We're checking for context here so that we can use this method both as a function and as a constructor. If a context isn't passed then we know that we need to use the method as a constructor and call the method again from within itself. And we're passing the context (<code>this</code>) the second time around to be used to assign the initial value for the util.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">product</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">MathUtil</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>The MathUtil prototype object</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">MathUtil</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">({},</span> <span class="p">{</span>
  <span class="nx">add</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">value</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">product</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">product</span> <span class="o">+</span> <span class="nx">value</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>We're returning <code>this</code> (the instance) here so that other methods can be called on (chained) what is returned.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nx">divideBy</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">value</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">product</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">product</span> <span class="o">/</span> <span class="nx">value</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nx">multiplyBy</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">value</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">product</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">product</span> <span class="o">*</span> <span class="nx">value</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nx">subtract</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">value</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">product</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">product</span> <span class="o">-</span> <span class="nx">value</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nx">value</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">value</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">product</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>So as you can see, by writing our simple recursive function <code>MathUtil</code> and by returning 'this' in each prototype method we can now chain the calls to perform a sequential process on the initial value (<code>100</code>) passed.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">val</span> <span class="o">=</span> <span class="nx">MathUtil</span><span class="p">(</span><span class="mi">100</span><span class="p">).</span><span class="nx">add</span><span class="p">(</span><span class="mi">20</span><span class="p">).</span><span class="nx">divideBy</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="nx">multiplyBy</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="nx">subtract</span><span class="p">(</span><span class="mi">10</span><span class="p">).</span><span class="nx">value</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">val</span><span class="p">);</span> <span class="c1">// should output `170`</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 