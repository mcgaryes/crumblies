<!DOCTYPE html>  <html> <head>   <title>005_singleton.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="001_prototypal-inheritance.html">                 001_prototypal-inheritance.js               </a>                                           <a class="source" href="002_extending-prototypes.html">                 002_extending-prototypes.js               </a>                                           <a class="source" href="003_prototype_mixins.html">                 003_prototype_mixins.js               </a>                                           <a class="source" href="004_chaining.html">                 004_chaining.js               </a>                                           <a class="source" href="005_singleton.html">                 005_singleton.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               005_singleton.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="s2">&quot;use strict&quot;</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>In development, a <a href="http://en.wikipedia.org/wiki/Singleton_pattern">singleton</a> pattern is a design pattern that restricts the instantiation of a class (or in JavaScripts sake an Prototypal Object) to one object. This is extremely useful when you want to make sure that application wide you're referencing the same object instance. </p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>The singleton pattern is actually quite easy accomplish with JavaScript as you already have a global variable, the window (in the case of the browser), right out of the gate! However that being the case, it also makes it extremely easy for another library to overwrite your Singletons. So we'll also be covering the simple concept of <a href="http://en.wikipedia.org/wiki/Namespace_(computer_science">namespacing</a>) in JavaScript in this discussion as well.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Something that I havent mentioned to date, but is somewhat of a useful feature in JavaScript are self executing functions. You can see an example in the following line of code. Basically we just want this function to run as soon as it loads. A lot of JavaScript libraries use this feature when they are writing themselves to the <code>window</code> object.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  </pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Creating a root variable here is just a bit of best practice. Referencing a lot through the <code>this</code> keyword can get confusing in longer scripts. I find its always a good idea to assigning what we've passed in as the context of this self executing function to root. This way whenever you see <code>root</code> you know exactly what it is refering to!</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">root</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>And here we're simply going to write our singleton object <code>Singleton</code> to the <code>root</code> (window) object. And that's it really! You esentially now have a singleton object.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">Singleton</span> <span class="o">=</span> <span class="nx">root</span><span class="p">.</span><span class="nx">Singleton</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">property</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">method</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{}</span>
  <span class="p">};</span>

<span class="p">}).</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Because our <code>Singleton</code> class is written on the window object it is now accessible</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">Singleton</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>This is all well and good, but what if we dont want to muddy up the <code>window</code> object (which isn't best practice if you're not a library or framework) with a bunch of objects. This is where namesapcing comes into play.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Here we're just going to do the same thing that we did with our original Singleton class, but we're going to be creating our namespace <code>Namespace</code>, and writing it to the <code>window</code> object instead.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">Namespace</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">Namespace</span> <span class="o">=</span> <span class="p">{};</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Now that we have our namespace ready we could do one of two things...
1. We could simply pass the <code>Namepsace</code> object as the functions context, the sameway we were passing <code>window</code> object before:</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

  <span class="kd">var</span> <span class="nx">root</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">Singleton</span> <span class="o">=</span> <span class="nx">root</span><span class="p">.</span><span class="nx">Singleton</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">property</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">method</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{}</span>
  <span class="p">};</span>

<span class="p">}).</span><span class="nx">call</span><span class="p">(</span><span class="nx">Namespace</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">Namespace</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <ol>
<li>Or we could simply write the singleton as an object on the namespace like so:</li>
</ol>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">Namespace</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">Namespace</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">Singleton</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">property</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">method</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{}</span>
  <span class="p">},</span>
  <span class="nx">AnotherSingleton</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">property</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">method</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{}</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">Namespace</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>What about limiting the ability for a user to simply write over our namespace? This could lead to unwanted consequences and could be potentially tough to track down.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Namespace</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">Namespace</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">somethingElseEntirely</span><span class="o">:</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre>  <span class="p">}</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>oops :(</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">Namespace</span><span class="p">.</span><span class="nx">Singleton</span><span class="p">);</span> <span class="c1">// logs `undefined`</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Well with ECMAScript 5 we could do something like the following:</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s2">&quot;AnotherSingleton&quot;</span><span class="p">,</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Here we're setting the <code>configurable</code> descriptor property to <code>false</code> so that this object cannot be deleted from our global (<code>window</code>) object. We're also using just a <code>get</code> so that it can not be overwritten.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">configurable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="nx">property</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="nx">method</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">AnotherSingleton</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>As you can see we cannot delete the <code>AnotherSingleton</code> object and trying to do so will result in an error</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">try</span> <span class="p">{</span>
  <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">AnotherSingleton</span><span class="p">;</span> 
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span> <span class="c1">// [TypeError: Cannot delete property &#39;Singleton&#39; of #&lt;Object&gt;]</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Setting configurable does however prevent you from writing new objects onto the Singleton. So keep this in mind when using this approach. Also as I've mentioned in previous discussions, property descriptors have limited browser support with legacy versions of Internet Explorer</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">this</span><span class="p">.</span><span class="nx">AnotherSingleton</span><span class="p">.</span><span class="nx">test</span> <span class="o">=</span> <span class="p">{};</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">AnotherSingleton</span><span class="p">.</span><span class="nx">test</span><span class="p">);</span> <span class="c1">// logs `undefined`</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>One last thing to mention is that the way in which we are creating these singletons, we could limit what is actually returned and available publicly.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">Namespace</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">Namespace</span> <span class="o">=</span> <span class="p">{};</span>

<span class="kd">var</span> <span class="nx">Singleton</span> <span class="o">=</span> <span class="nx">Namespace</span><span class="p">.</span><span class="nx">Singleton</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">(){</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>A private method that will be accessible only within this closure</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">privateMethod</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;private method&quot;</span><span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Our <em>interface</em> to return as public</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">publicMethod</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;public method&quot;</span><span class="p">);</span>
      <span class="nx">privateMethod</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">}());</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Notice that you only see the <code>publicMethod</code> that we returned from within the module.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">Singleton</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>You can call the <code>publicMethod</code> which in turn calls the <code>privateMethod</code>:</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Singleton</span><span class="p">.</span><span class="nx">publicMethod</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>But we can't call the <code>privateMethod</code> directly. It is esentially private now.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">try</span> <span class="p">{</span>
  <span class="nx">Singleton</span><span class="p">.</span><span class="nx">privateMethod</span><span class="p">();</span>  
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span> <span class="c1">// [TypeError: Object #&lt;Object&gt; has no method &#39;privateMethod&#39;]</span>
<span class="p">}</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 